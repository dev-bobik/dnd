<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DnD Battle Grid</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: row;
      margin: 0;
      padding: 0;
      background-color: #2e2e2e;
      color: white;
      height: 100vh;
    }

    #sidebar {
      width: 200px;
      background-color: #1f1f1f;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      overflow-y: auto;
    }

    .library-token {
      width: 50px;
      height: 50px;
      cursor: grab;
      border: 1px solid #666;
    }

    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }

    #controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    #grid-container {
      position: relative;
      aspect-ratio: 1 / 1;
      width: 1000px;
    }

    #background {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #grid {
      display: grid;
      gap: 1px;
      background-color: transparent;
      border: 2px solid #555;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
      width: 100%;
      height: 100%;
    }

    .cell {
      background-color: rgba(68, 68, 68, 0.7);
      border: 1px solid #666;
      position: relative;
    }

    .token {
      position: absolute;
      cursor: grab;
      z-index: 2;
    }

    input[type="file"], select {
      margin: 0.5rem 0;
    }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCIZjiTltMTVktH4qTuW4iclUqFwuIbU9E",
      authDomain: "heil-47dc3.firebaseapp.com",
      databaseURL: "https://heil-47dc3-default-rtdb.firebaseio.com",
      projectId: "heil-47dc3",
      storageBucket: "heil-47dc3.appspot.com",
      messagingSenderId: "204548727050",
      appId: "1:204548727050:web:14066e11908a1fd97f9af3",
      measurementId: "G-TJZZDNCV05"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body>
  <div id="sidebar">
    <h3>Knihovna</h3>
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Red_circle.png/600px-Red_circle.png" class="library-token" draggable="true">
    <img src="data:image/jpeg;base64,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" class="library-token" draggable="true">
  </div>
  <div id="main">
    <h1>DnD Fight Grid</h1>
    <div id="controls">
      <label>Nahrát tokeny: <input type="file" id="upload" accept="image/*" /></label>
      <label>Nahrát pozadí: <input type="file" id="backgroundUpload" accept="image/*" /></label>
      <label>Velikost polí:
        <select id="cellSizeSelect">
          <option value="25">25px (40x40)</option>
          <option value="33">33px (30x30)</option>
          <option value="50" selected>50px (20x20)</option>
          <option value="100">100px (10x10)</option>
          <option value="200">200px (5x5)</option>
        </select>
      </label>
    </div>
    <div id="grid-container">
      <img id="background" />
      <div id="grid"></div>
    </div>
  </div>

  <script>
    const grid = document.getElementById('grid');
    const cellSizeSelect = document.getElementById('cellSizeSelect');
    const containerSize = 1000;
    let gridSize = 20;
    let cellSize = parseInt(cellSizeSelect.value);

    function createGrid() {
      grid.innerHTML = '';
      gridSize = Math.floor(containerSize / cellSize);
      grid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
      grid.style.gridTemplateRows = `repeat(${gridSize}, 1fr)`;
      for (let i = 0; i < gridSize * gridSize; i++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        grid.appendChild(cell);
      }
    }

    cellSizeSelect.addEventListener('change', () => {
      const newCellSize = parseInt(cellSizeSelect.value);
      const scale = newCellSize / cellSize;
      cellSize = newCellSize;
      createGrid();

      document.querySelectorAll('.token').forEach(token => {
        const newLeft = parseFloat(token.style.left) * scale;
        const newTop = parseFloat(token.style.top) * scale;
        token.style.width = `${cellSize}px`;
        token.style.height = `${cellSize}px`;
        token.style.left = `${newLeft}px`;
        token.style.top = `${newTop}px`;

        const tokenId = Object.entries(db._root._value.tokens || {}).find(([_, t]) => t.src === token.src)?.[0];
        if (tokenId) {
          db.ref('tokens/' + tokenId).update({
            top: newTop,
            left: newLeft,
            width: cellSize,
            height: cellSize
          });
        }
      });
    });

    createGrid();

    const upload = document.getElementById('upload');
    const db = firebase.database();

    upload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (event) {
        const id = Date.now();
        const tokenData = {
          id,
          src: event.target.result,
          top: 0,
          left: 0,
          width: cellSize,
          height: cellSize
        };
        db.ref('tokens/' + id).set(tokenData);
      };

      reader.readAsDataURL(file);
      e.target.value = "";
    });

    db.ref('tokens').on('value', (snapshot) => {
      const tokens = snapshot.val();
      document.querySelectorAll('.token').forEach(el => el.remove());
      for (let key in tokens) {
        const data = tokens[key];
        const img = document.createElement('img');
        img.src = data.src;
        img.classList.add('token');
        img.draggable = true;
        img.style.top = `${data.top}px`;
        img.style.left = `${data.left}px`;
        img.style.width = `${data.width}px`;
        img.style.height = `${data.height}px`;

        let offsetX, offsetY;

        img.addEventListener('dragstart', (e) => {
          offsetX = e.offsetX;
          offsetY = e.offsetY;
        });

        img.addEventListener('dragend', (e) => {
          const rect = grid.getBoundingClientRect();
          const newLeft = e.clientX - rect.left - offsetX;
          const newTop = e.clientY - rect.top - offsetY;
          db.ref('tokens/' + data.id).update({ left: newLeft, top: newTop });
        });

        grid.appendChild(img);
      }
    });

    document.querySelectorAll('.library-token').forEach(token => {
      token.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('src', token.src);
      });
    });

    grid.addEventListener('dragover', (e) => e.preventDefault());
    grid.addEventListener('drop', (e) => {
      e.preventDefault();
      const rect = grid.getBoundingClientRect();
      const src = e.dataTransfer.getData('src');
      const id = Date.now();
      db.ref('tokens/' + id).set({
        id,
        src,
        top: e.clientY - rect.top,
        left: e.clientX - rect.left,
        width: cellSize,
        height: cellSize
      });
    });

    const backgroundInput = document.getElementById('backgroundUpload');
    const background = document.getElementById('background');

    function startRealtimeSync() {
      db.ref('background').on('value', (snapshot) => {
        if (snapshot.val()) {
          background.src = snapshot.val();
        }
      });

      backgroundInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (event) {
          const imageUrl = event.target.result;
          background.src = imageUrl;
          db.ref('background').set(imageUrl);
        };

        reader.readAsDataURL(file);
        e.target.value = "";
      });
    }

    firebase.auth().signInAnonymously()
      .then(() => {
        console.log("✅ Přihlášen anonymně");
        startRealtimeSync();
      })
      .catch((error) => {
        console.error("❌ Přihlášení selhalo:", error);
      });
  </script>
</body>
</html>

